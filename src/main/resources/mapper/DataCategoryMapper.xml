<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.cmfchina.dataportal.mapper.DataCategoryMapper">
    <resultMap id="BaseResultMap" type="com.cmfchina.dataportal.entity.DataCategory">
        <id column="category_id" property="categoryId" />
        <result column="category_name" property="categoryName" />
        <result column="parent_id" property="parentId" />
        <result column="description" property="description" />
        <result column="display_order" property="displayOrder" />
        <result column="icon" property="icon" />
        <result column="banner_image" property="bannerImage" />
        <result column="detailed_description" property="detailedDescription" />
        <result column="is_visible" property="isVisible" />
        <result column="created_by" property="createdBy" />
        <result column="updated_by" property="updatedBy" />
        <result column="created_at" property="createdAt" />
        <result column="updated_at" property="updatedAt" />
        <result column="theme_code" property="themeCode" />

    </resultMap>

    <insert id="insert">
        INSERT INTO data_categories(category_id, category_name, parent_id, description,
        display_order, icon, banner_image, detailed_description, is_visible,
        created_by, updated_by, created_at, updated_at,theme_code)
        VALUES(#{categoryId}, #{categoryName}, #{parentId}, #{description},
        #{displayOrder}, #{icon}, #{bannerImage}, #{detailedDescription}, #{isVisible},
        #{createdBy}, #{updatedBy},NOW(), NOW(), #{themeCode})
    </insert>

    <update id="update">
        UPDATE data_categories SET
        category_name = #{categoryName},
        parent_id = #{parentId},
        description = #{description},
        display_order = #{displayOrder},
        icon = #{icon},
        banner_image = #{bannerImage},
        detailed_description = #{detailedDescription},
        is_visible = #{isVisible},
        updated_by = #{updatedBy},
        updated_at = NOW(),
        theme_code = #{themeCode}
        WHERE category_id = #{categoryId}
    </update>

    <delete id="deleteById">
        DELETE FROM data_categories WHERE category_id = #{categoryId}
    </delete>

    <select id="selectById" resultMap="BaseResultMap">
        SELECT * FROM data_categories WHERE category_id = #{categoryId}
    </select>

    <select id="selectAll" resultMap="BaseResultMap">
        SELECT * FROM data_categories
        <where>
            1=1
            <if test="categoryName != null and categoryName != ''">
                AND category_name LIKE CONCAT('%', #{categoryName}, '%')
            </if>
        </where>
        ORDER BY  display_order,created_at  ASC
            LIMIT   #{size} OFFSET   #{currentPage}
    </select>


    <select id="getCategoriesTopList"  resultMap="BaseResultMap">
        SELECT *
        FROM data_categories  where is_visible = 1
        ORDER BY display_order,updated_at  ASC  LIMIT  #{topLimit}   OFFSET   0
    </select>



    <select id="countAll"   resultType="java.lang.Integer">
        SELECT  COUNT(*) FROM data_categories
        <where>
            1=1
            <if test="categoryName != null and categoryName != ''">
                AND category_name LIKE CONCAT('%', #{categoryName}, '%')
            </if>
        </where>
    </select>


    <select id="selectByParentId" resultMap="BaseResultMap">
        SELECT * FROM data_categories WHERE parent_id = #{parentId} ORDER BY display_order
    </select>

    <select id="selectTopCategories"  resultMap="BaseResultMap">
        SELECT *
        FROM data_categories
        <where>
            parent_id IS NULL
            <if test="categoryName != null and categoryName != ''">
                AND category_name LIKE CONCAT('%', #{categoryName}, '%')
            </if>
        </where>
        ORDER BY display_order   LIMIT   #{size} OFFSET   #{currentPage}
    </select>



    <select id="selectByNameLike" resultMap="BaseResultMap">
        SELECT * FROM data_categories WHERE category_name LIKE CONCAT('%', #{categoryName}, '%') ORDER BY display_order
    </select>
</mapper>